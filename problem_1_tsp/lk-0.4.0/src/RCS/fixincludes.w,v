head	1.159;
access
	david
	neto;
symbols
	zero-four-zero:1.159;
locks
	neto:1.159;


1.159
date	98.07.16.21.58.55;	author neto;	state Exp;
branches;
next	1.158;

1.158
date	98.05.21.15.48.15;	author neto;	state Exp;
branches;
next	1.157;

1.157
date	97.12.13.19.43.57;	author neto;	state Exp;
branches;
next	1.156;

1.156
date	97.12.04.21.28.51;	author neto;	state Exp;
branches;
next	1.155;

1.155
date	97.11.27.19.13.57;	author neto;	state Exp;
branches;
next	1.154;

1.154
date	97.11.15.19.03.46;	author neto;	state Exp;
branches;
next	1.153;

1.153
date	97.09.27.18.05.36;	author neto;	state Exp;
branches;
next	1.152;

1.152
date	97.08.15.20.18.25;	author neto;	state Exp;
branches;
next	1.151;

1.151
date	97.05.16.21.06.39;	author neto;	state Exp;
branches;
next	1.150;

1.150
date	97.05.16.21.01.52;	author neto;	state Exp;
branches;
next	1.149;

1.149
date	97.05.16.20.49.20;	author neto;	state Exp;
branches;
next	1.148;

1.148
date	97.05.16.20.36.37;	author neto;	state Exp;
branches;
next	1.147;

1.147
date	97.04.22.21.47.42;	author neto;	state Exp;
branches;
next	1.146;

1.146
date	97.02.07.22.54.45;	author neto;	state Exp;
branches;
next	1.145;

1.145
date	97.01.21.22.26.34;	author david;	state Exp;
branches;
next	1.144;

1.144
date	97.01.21.21.55.55;	author david;	state Exp;
branches;
next	1.143;

1.143
date	96.12.16.17.06.55;	author neto;	state Exp;
branches;
next	1.142;

1.142
date	96.08.16.16.50.13;	author neto;	state Exp;
branches;
next	1.141;

1.141
date	96.08.16.13.36.11;	author neto;	state Exp;
branches;
next	1.140;

1.140
date	96.08.16.13.05.17;	author neto;	state Exp;
branches;
next	;


desc
@Provide prototypes for broken header files on SunOS and maybe other
environments.
@


1.159
log
@Added the LGPL notice in each file.
@
text
@



\noindent Copyright \copyright 1994, 1995, 1996, 1997, 1998 David Neto
\smallskip

\noindent 
   This library is free software; you can redistribute it and/or
   modify it under the terms of the GNU Library General Public
   License as published by the Free Software Foundation; either
   version 2 of the License, or (at your option) any later version.
\smallskip

\noindent 
   This library is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   Library General Public License for more details.
\smallskip

\noindent   
   You should have received a copy of the GNU Library General Public
   License along with this library; if not, write to the
   Free Software Foundation, Inc., 59 Temple Place - Suite 330,
   Boston, MA  02111-1307, USA.
\smallskip

\noindent   
   You may contact David Neto via email at {\tt netod@@@@acm.org}, or with
   greater latency at
\smallskip
\noindent{\obeylines
     Department of Computer Science
     University of Toronto
     10 King's College Rd.
     Toronto, Ontario
     M5S 3G4
     Canada
}
\medskip


\noindent\hbox{}\hrule\hbox{}\penalty-1000
\vskip0.5cm\relax



@@i webdefs.w
@@i types.w

{\obeylines
$Log: fixincludes.w,v $
Revision 1.158  1998/05/21 15:48:15  neto
use size t instead of int in gethostname.
Red Hat Linux (Biltmore) barfs now on ustat...

Revision 1.157  1997/12/13 19:43:57  neto
Added test for whether header defines prototypes for getopt.
But I give up my hands on it (at least in JITTER).

Revision 1.156  1997/12/04  21:28:51  neto
Added support for nrand48

Revision 1.155  1997/11/27  19:13:57  neto
Attempt at clean declaration of getopt and friends.

Revision 1.154  1997/11/15 19:03:46  neto
Fixed comments for CWEB.
Also, Autoconf macro is HAVE VPRINTF, not HAVE VFPRINTF...

Revision 1.153  1997/09/27 18:05:36  neto
Fixed RCS log behaviour.

Revision 1.152  1997/08/15  20:18:25  neto
Added Index major section.

Revision 1.151  1997/05/16  21:06:39  neto
Be less intrusive with vfprintf.

Revision 1.150  1997/05/16  21:01:52  neto
Fixed other unterminated hash ifs.
Also commented them.. :)

Revision 1.149  1997/05/16  20:49:20  neto
Put a hash endif on.

Revision 1.148  1997/05/16  20:36:37  neto
Put some support in from configure

Revision 1.147  1997/04/22  21:47:42  neto
SunOS 5.4 does not put struct rusage in sys/resource.h.
So I must handle it specially.  See the changes to
the Makefile as well.

Revision 1.146  1997/02/07  22:54:45  neto
Added scanf

Revision 1.145  1997/01/21  22:26:34  david
Line was too long.

Revision 1.144  1997/01/21  21:55:55  david
Added standard copyright notice by including copyrt.w

Revision 1.143  96/12/16  17:06:55  neto
Added time header.

Revision 1.142  96/08/16  16:50:13  neto
Fixed a preprocessor syntax error.
Added rcs id.

Revision 1.141  96/08/16  13:36:11  neto
Split resource stuff into resource stuff and gethostname

Revision 1.140  96/08/16  13:05:17  neto
Initial revision.

}

@@*Missing prototypes.
Some operating environments don't provide full prototypes for some of
their library functions.  SunOS is guilty of this.  This module defines
these prototypes we need in a special header file \file{fixincludes.h}.  

Most of the missing prototypes are taken from P.~J.~Plauger's {\sl 
The Standard C Library}, Prentice-Hall, ISBN 0-13-131509-9.

Prototypes dealing with resources are taken from the SunOS manual page
for the respective functions.  They are not part of the standard C library.

@@(fixincludes.h@@>=
#if defined(OS_HAS_BROKEN_HEADERS) && !defined(_FIXINCLUDES_H_)
#define _FIXINCLUDES_H_

#if defined(FIXINCLUDES_USE_RCS_ID)
static const char *fixincludes_rcs_id = 
	"$Id: fixincludes.w,v 1.158 1998/05/21 15:48:15 neto Exp neto $";
#endif /* |defined(FIXINCLUDES_USE_RCS_ID)| */


int fclose(FILE *stream);
int fflush(FILE *stream);
int fprintf(FILE *stream, const char *format,...);
int fputc(int c, FILE *stream);
size_t fread(void *ptr, size_t size, size_t nmemb, FILE*stream);
int scanf(const char *format,...);
int fscanf(FILE *stream, const char *format,...);
size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE*stream);
int printf(const char *format,...);

#if defined(FIXINCLUDES_NEED_VFPRINTF)
#if HAVE_VPRINTF
int vfprintf(FILE *stream, const char *format, va_list arg);
#else /* not |HAVE_VFPRINTF| */
#define vfprintf /* Just throw it away... */
#endif /* not |HAVE_VFPRINTF| */
#endif /* |defined(FIXINCLUDES_NEED_VFPRINTF)| */


#if defined(FIXINCLUDES_NEED_GETHOSTNAME)
#if HAVE_GETHOSTNAME
int gethostname(char *nameptr, size_t namelen);
#else 		/* not |HAVE_GETHOSTNAME| */
static int gethostname(char *nameptr, size_t namelen)
{ return strncpy(nameptr,"<unknown>",namelen); }
#endif 		/* not |HAVE_GETHOSTNAME| */
#endif /* |defined(FIXINCLUDES_NEED_GETHOSTNAME)| */


#if defined(FIXINCLUDES_NEED_RESOURCE_STUFF)
/* SunOS 5.4, a.k.a. Solaris 2.4 is peculiar.  Why, why, why? */
#if OS_IS_SUNOS && OS_VERSION_MAJOR==5 && OS_VERSION_MINOR==4 
#include <../ucbinclude/sys/rusage.h>
#endif /* |defined(FIXINCLUDES_NEED_RESOURCE_STUFF)| */
#if HAVE_GETPAGESIZE && HAVE_GETRUSAGE
int getpagesize(void);
int getrusage(int who, struct rusage *rusage);
#else /* not |(HAVE_GETPAGESIZE && HAVE_GETRUSAGE)| */
static int getpagesize(void) {return 0;}
static int getrusage(void) {return NULL;} /* Only resolve the function call. */
#endif /* not |(HAVE_GETPAGESIZE && HAVE_GETRUSAGE)| */
#endif /* |defined(FIXINCLUDES_NEED_RESOURCE_STUFF)| */

#if defined(FIXINCLUDES_NEED_TIME_STUFF)
#if HAVE_TIME_H
#include <time.h>
#else /* not |HAVE_TIME_H| */
typedef long time_t;
#endif /* not |HAVE_TIME_H| */
time_t time(time_t *);
#endif /* |defined(FIXINCLUDES_NEED_TIME_STUFF)| */

/* Solaris headers appear to not have a prototype for |getopt|. */
#if defined(FIXINCLUDES_NEED_GETOPT)
#if HAVE_GETOPT
int getopt(int argc, char * const argv[], const char *optstring);
#if LIBRARY_DEFINES_OPTARG_ETC && !HEADERS_DECLARE_OPTARG_ETC
extern char *optarg;
extern int optind, opterr, optopt;
#else
char *optarg;
int optind, opterr, optopt;
#endif /* |LIBRARY_DEFINES_OPTARG_ETC| */
#endif /* |HAVE_GETOPT| */
#endif /* |defined(FIXINCLUDES_NEED_GETOPT)| */

/* Solaris headers appear to not have a prototype for |nrand48|. */
#if defined(FIXINCLUDES_NEED_NRAND48)
#if HAVE_NRAND48
long nrand48(unsigned short int state[3]);
#endif /* |HAVE_NRAND48| */
#endif /* |defined(FIXINCLUDES_NEED_NRAND48)| */


#endif /* |defined(OS_HAS_BROKEN_HEADERS) && !defined(_FIXINCLUDES_H_)| */

@@*Index.
@


1.158
log
@use size t instead of int in gethostname.
Red Hat Linux (Biltmore) barfs now on ustat...
@
text
@d1 48
a48 1
@@i copyrt.w
d54 4
d137 1
a137 1
	"$Id: fixincludes.w,v 1.157 1997/12/13 19:43:57 neto Exp neto $";
@


1.157
log
@Added test for whether header defines prototypes for getopt.
But I give up my hands on it (at least in JITTER).
@
text
@d7 4
d86 1
a86 1
	"$Id: fixincludes.w,v 1.156 1997/12/04 21:28:51 neto Exp neto $";
d111 1
a111 1
int gethostname(char *nameptr, int namelen);
d113 1
a113 1
static int gethostname(char *nameptr, int namelen) 
@


1.156
log
@Added support for nrand48
@
text
@d7 3
d82 1
a82 1
	"$Id: fixincludes.w,v 1.155 1997/11/27 19:13:57 neto Exp neto $";
d142 1
a142 1
#if LIBRARY_DEFINES_OPTARG_ETC
@


1.155
log
@Attempt at clean declaration of getopt and friends.
@
text
@d7 3
d79 1
a79 1
	"$Id: fixincludes.w,v 1.154 1997/11/15 19:03:46 neto Exp neto $";
d148 7
@


1.154
log
@Fixed comments for CWEB.
Also, Autoconf macro is HAVE VPRINTF, not HAVE VFPRINTF...
@
text
@d7 4
d76 1
a76 1
	"$Id: fixincludes.w,v 1.153 1997/09/27 18:05:36 neto Exp neto $";
d131 15
@


1.153
log
@Fixed RCS log behaviour.
@
text
@d7 3
d17 1
a17 1
Fixed other unterminated #ifs.
d21 1
a21 1
Put an #endif on.
d72 2
a73 2
	"$Id: fixincludes.w,v 1.152 1997/08/15 20:18:25 neto Exp neto $";
#endif /* defined(FIXINCLUDES_USE_RCS_ID) */
d87 1
a87 1
#if HAVE_VFPRINTF
d89 4
a92 4
#else /* not HAVE_VFPRINTF */
#define vfprintf fprintf
#endif /* not HAVE_VFPRINTF */
#endif /* defined(FIXINCLUDES_NEED_VFPRINTF) */
d98 1
a98 1
#else 		/* not HAVE_GETHOSTNAME */
d101 2
a102 2
#endif 		/* not HAVE_GETHOSTNAME */
#endif /* defined(FIXINCLUDES_NEED_GETHOSTNAME) */
d109 1
a109 1
#endif /* defined(FIXINCLUDES_NEED_RESOURCE_STUFF) */
d113 1
a113 1
#else /* not (HAVE_GETPAGESIZE && HAVE_GETRUSAGE) */
d116 2
a117 2
#endif /* not (HAVE_GETPAGESIZE && HAVE_GETRUSAGE) */
#endif /* defined(FIXINCLUDES_NEED_RESOURCE_STUFF) */
d122 1
a122 1
#else /* not HAVE_TIME_H */
d124 1
a124 1
#endif /* not HAVE_TIME_H */
d126 1
a126 1
#endif /* defined(FIXINCLUDES_NEED_TIME_STUFF) */
d128 1
a128 1
#endif /* defined(OS_HAS_BROKEN_HEADERS) && !defined(_FIXINCLUDES_H_) */
@


1.152
log
@Added Index major section.
@
text
@d5 5
a9 1
{\obeylines$Log: fixincludes.w,v $
d69 1
a69 1
	"$Id: fixincludes.w,v 1.151 1997/05/16 21:06:39 neto Exp neto $";
@


1.151
log
@Be less intrusive with vfprintf.
@
text
@d6 3
d65 1
a65 1
	"$Id: fixincludes.w,v 1.150 1997/05/16 21:01:52 neto Exp neto $";
d122 2
@


1.150
log
@Fixed other unterminated #ifs.
Also commented them.. :)
@
text
@d6 4
d62 1
a62 1
	"$Id: fixincludes.w,v 1.149 1997/05/16 20:49:20 neto Exp neto $";
d79 3
a81 5
#else 		/* not HAVE_VFPRINTF */
static int 
vfprintf(FILE *stream, const char *format, va_list arg)
{ return fprintf(stream,format,arg); }
#endif 		/* not HAVE_VFPRINTF */
@


1.149
log
@Put an #endif on.
@
text
@d6 3
d58 2
a59 2
	"$Id: fixincludes.w,v 1.148 1997/05/16 20:36:37 neto Exp neto $";
#endif
d80 1
a80 1
#endif
d90 2
d97 1
a97 1
#endif
d115 2
@


1.148
log
@Put some support in from configure
@
text
@d6 3
d55 1
a55 1
	"$Id: fixincludes.w,v 1.147 1997/04/22 21:47:42 neto Exp neto $";
d100 1
@


1.147
log
@SunOS 5.4 does not put struct rusage in sys/resource.h.
So I must handle it specially.  See the changes to
the Makefile as well.
@
text
@d6 5
d47 1
a47 1
#if defined(FIX_INCLUDES) && !defined(_FIXINCLUDES_H_)
d52 1
a52 1
	"$Id: fixincludes.w,v 1.146 1997/02/07 22:54:45 neto Exp neto $";
d67 1
d69 5
d78 1
d80 4
a83 1
#endif
d86 2
a87 2
/* SunOS 5.4 is peculiar. Why, why, why? */
#if defined(__sun) && OS_VERSION_MAJOR==5 && OS_VERSION_MINOR==4 
d90 1
d93 4
a96 1
#endif
d99 1
d101 3
d105 1
a105 2
#endif
#endif
@


1.146
log
@Added scanf
@
text
@d6 3
d47 1
a47 1
	"$Id: fixincludes.w,v 1.145 1997/01/21 22:26:34 david Exp david $";
d71 4
@


1.145
log
@Line was too long.
@
text
@d6 3
d44 1
a44 1
	"$Id: fixincludes.w,v 1.144 1997/01/21 21:55:55 david Exp david $";
d53 1
@


1.144
log
@Added standard copyright notice by including copyrt.w
@
text
@d5 4
a8 1
{\obeylines$Log:	fixincludes.w,v $
d40 2
a41 1
static const char *fixincludes_rcs_id = "$Id: fixincludes.w,v 1.143 96/12/16 17:06:55 neto Exp $";
@


1.143
log
@Added time header.
@
text
@d1 1
d6 3
d37 1
a37 1
static const char *fixincludes_rcs_id = "$Id: fixincludes.w,v 1.142 96/08/16 16:50:13 neto Exp $";
@


1.142
log
@Fixed a preprocessor syntax error.
Added rcs id.
@
text
@d5 4
d33 1
a33 1
static const char *fixincludes_rcs_id = "$Id$";
d58 5
@


1.141
log
@Split resource stuff into resource stuff and gethostname
@
text
@d5 3
d28 5
d47 1
a47 1
#if defined(FIXINCLUDES_NEED_GETHOSTNAME
@


1.140
log
@Initial revision.
@
text
@d4 4
a7 1
{\obeylines$Log$
d38 5
a43 1
int gethostname(char *nameptr, int namelen);
d45 1
a45 18
int getrusage(int who, struct {	
               struct timeval ru_utime;      /* user time used */
               struct timeval ru_stime;      /* system time used */
               int  ru_maxrss;          /* maximum resident set size */
               int  ru_ixrss;      /* currently 0 */
               int  ru_idrss;      /* integral resident set size */
               int  ru_isrss;      /* currently 0 */
               int  ru_minflt;          /* page faults not requiring physical I/O */
               int  ru_majflt;          /* page faults requiring physical I/O */
               int  ru_nswap;      /* swaps */
               int  ru_inblock;         /* block input operations */
               int  ru_oublock;         /* block output operations */
               int  ru_msgsnd;          /* messages sent */
               int  ru_msgrcv;          /* messages received */
               int  ru_nsignals;        /* signals received */
               int  ru_nvcsw;      /* voluntary context switches */
               int  ru_nivcsw;          /* involuntary context switches */
          } *rusage);
@
